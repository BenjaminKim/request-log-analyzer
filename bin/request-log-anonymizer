#!/usr/bin/ruby
require File.dirname(__FILE__) + '/../lib/request_log_analyzer'
require File.dirname(__FILE__) + '/../lib/request_log_analyzer/log_anonymizer'
require File.dirname(__FILE__) + '/../lib/cli/command_line_arguments'

puts "Request log anonymizer, by Willem van Bergen and Bart ten Brinke\n\n"

# Parse the arguments given via commandline
begin
  arguments = CommandLine::Arguments.parse do |command_line|
    

    command_line.option(:format, :alias => :f, :default => 'rails')    
    command_line.switch(:discard_teaser_lines, :t)
    command_line.switch(:keep_junk_lines, :j)    
    command_line.switch(:debug)
    command_line.minimum_parameters = 1
  end
  
rescue CommandLine::Error => e
  puts "ARGUMENT ERROR: " + e.message
  puts
  puts "USAGE: request-log-anonymizer <input> <output>"
  exit(0) 
end

# Run the request_log_analyzer!
RequestLogAnalyzer::LogAnonymizer.build(arguments).run!
